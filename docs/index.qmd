---
title: "Abschlussprojekt" 
subtitle: "rstatsZH-K009:" 
autor: "hugobre" 
format: html 
editor: visual 
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(ggthemes)
```

```{r}
winterthur <- read_csv(here::here("daten/raw/KTZH_00002604_00005328.csv"))
```

# Einleitung

....folgt noch....

## Daten

Titel: Bevölkerung der Stadt Winterthur, nach Staatenkleingruppe und Quartier

Bestand der wirtschaftlichen Wohnbevölkerung nach Staatenkleingruppe und Quartier per Ende Jahr. Eine vollständige Dokumentation ist der Ressource "Dokumentation Daten" zu finden.

Die Daten stammen vom Statistischen Amt des Kantons Zürich und sind unter folgendem Link abrufbar: https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/

## Analyseziele

Mittels Datenaufbereitung und Visualisierung aufzeigen, wie sich die Zusammensetzung der Bevölkerung der Stadt Winterthur entwickelt hat.

# Daten Aufbereitung

```{r}
glimpse(winterthur)

# Bevölkerung_Winterthur_Quartiere <- KTZH_00002604_00005328_2_[is.na(KTZH_00002604_00005328_2_$gemeinde),] %>% 
#   separate(col = 1, into = c("jahr",
#                                 "gemeinde_bfs_nr",
#                                 "gemeinde",
#                                 "stadtkreis_bfs_nr",
#                                 "stadtkreis",
#                                 "quartier_bfs_nr",
#                                 "quartier",
#                                 "staatenkleingruppe",
#                                 "region1",
#                                 "region2",
#                                 "anzahl",
#                                 "anzahl_ist_kleingruppe"),
#            sep = ",") %>% 
#   unite(region, c(region1, region2), sep = ", ")
#   

```

```{r}
winterthur |> 
  distinct(anzahl_ist_kleingruppe)

# ersetze deine Objektnamen durch wintherthur

winterthur %>% 
  distinct(anzahl_ist_kleingruppe)

winterthur %>% 
  filter(stadtkreis == "unbekannt")

Daten_Region_und_Stadtkreis_bereinigt <- winterthur |> 
  filter(stadtkreis %in% c("Stadt","Veltheim","Seen", "Töss", "Mattenbach", "Oberwinterthur", "Wülflingen"))

Winterthur <- Daten_Region_und_Stadtkreis_bereinigt
```

```{r}
write_csv(x = Daten_Region_und_Stadtkreis_bereinigt,
          here::here("daten/processed/Daten-Projekt-hugobre.csv"))
```

```{r}
Winterthur_fct <- Winterthur |> 
  mutate(anzahl = factor(anzahl))

Winterthur_fct$anzahl <- gsub("[^0-9.]", "", Winterthur_fct$anzahl)

Winterthur_fct$anzahl <- as.numeric(Winterthur_fct$anzahl)

Summe_Jahr_ohne_CH<- Winterthur_fct |> 
  group_by(jahr, staatenkleingruppe) |> 
  summarise(summe = sum(anzahl, na.rm = TRUE)) |> 
  filter(staatenkleingruppe != "Schweiz")

Groesste_Gruppen_Winterthur <- Summe_Jahr_ohne_CH |> 
  filter(staatenkleingruppe %in% c("Deutschland", "Italien", "Asien", "Mazedonien", "Türkei", "Afrika"))

Winterthur |> 
  group_by(quartier, staatenkleingruppe)
```

```{r}
# Jaehrliche_Zunahme_AU_Winterthur <- Summe_Jahr |> 
#   arrange(staatenkleingruppe, jahr) |> 
#   group_by(staatenkleingruppe) |> 
#   mutate(differenz = summe - lag(summe)) |> 
#   ungroup()
```

```{r}
Daten_Region_und_Stadtkreis_bereinigt$staat_gruppe <- ifelse(Daten_Region_und_Stadtkreis_bereinigt$staatenkleingruppe == "Schweiz", "Schweiz", "Ausland")

Daten_Region_und_Stadtkreis_bereinigt$anzahl <- 
  as.numeric(Daten_Region_und_Stadtkreis_bereinigt$anzahl)

Winterthur_total <- Daten_Region_und_Stadtkreis_bereinigt |> 
  group_by(jahr, staat_gruppe) |> 
  summarise(sum = sum(anzahl, na.rm = TRUE))
```

# Daten Visualisierung

```{r}
ggplot(data = Winterthur_total, 
       mapping = aes(x= jahr,
                     y= sum,
                     fill = staat_gruppe))+
  geom_col()+
  scale_fill_manual(values = c("aquamarine3", "aquamarine4")) +
  
    labs(title = "Bevölkerungsentwicklung Winterthur",
         subtitle = "Ausländer, Schweizer",
         y = "Anzahl Personen",
         x = "Jahr",
         fill = "Staatsangehörigkeit",
         caption = "Daten: https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(angle = 90, 
                                     vjust = 0.5))
```

```{r}
ggplot(data = Groesste_Gruppen_Winterthur,
       mapping = aes (x = jahr,
                      y = summe,
                      group = staatenkleingruppe,
                      color = staatenkleingruppe))+
  geom_line()+
  scale_color_colorblind()+
  labs(title = "Bevölkerungsentwicklung Winterthur",
        subtitle = "Entwicklung der 6 grössten Ausländergruppen in den letzten 10 Jahren",
         y = "Anzahl Personen",
         x = "Jahr",
         color = "Ausländergruppen", shape = "Ausländergruppen",
         caption = "Daten: https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(angle = 90, 
                                     vjust = 0.5))
```

```{r}
```

```{r}
```
