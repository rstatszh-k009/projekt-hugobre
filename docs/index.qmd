---
title: "Abschlussprojekt" 
subtitle: "rstatsZH-K009:" 
autor: "hugobre" 
format: 
  html:
    embed-resources: true
    toc: true
execute: 
  warning: false
# mögliche auswahl für jahr sind: 2014, 2015, 2016 usw. bis 2023
# mögliche auswahl für stadtkreis sind: Stadt, Veltheim, Seen, Töss, Mattenbach, Oberwinterthur, Wülflingen
params:
  jahr: 2023
  stadtkreis: Veltheim
editor: visual 
editor_options: 
  chunk_output_type: console
---

```{r}
source(here::here("analyse/01-daten-aufbereitung.R"))
```

```{r}
daten_stadtkreis <- winterthur_daten_bereinigt |> 
  group_by(jahr, stadtkreis, staatenkleingruppe) |> 
  summarise(summe = sum(anzahl, na.rm = TRUE)) |> 
  filter(stadtkreis == params$stadtkreis, jahr == params$jahr) |> 
  knitr::kable()
  

```

# Einleitung

Im Rahmen des R-Kurses wird zum Abschluss von jedem Teilnehmer eine Projektarbeit erstellt. Die Anforderungen sind unter <https://rstatszh-k009.github.io/website/abschlussprojekt/> zu finden.

## Daten

Titel: Bevölkerung der Stadt Winterthur, nach Staatenkleingruppe und Quartier

Bestand der wirtschaftlichen Wohnbevölkerung nach Staatenkleingruppe und Quartier per Ende Jahr. Eine vollständige Dokumentation ist der Ressource "Dokumentation Daten" zu finden.

Die Daten stammen vom Statistischen Amt des Kantons Zürich und sind unter folgendem Link abrufbar: <https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/>

## Analyseziele

Mittels Datenaufbereitung und Visualisierung aufzeigen, wie sich die Zusammensetzung der Bevölkerung der Stadt Winterthur entwickelt hat.

# Daten Aufbereitung

```{r}
glimpse(winterthur)

winterthur |> 
  distinct(stadtkreis)
```

```{r}
winterthur |> 
  distinct(anzahl_ist_kleingruppe)


winterthur %>% 
filter(stadtkreis == "unbekannt")

winterthur_daten_bereinigt <- winterthur |> 
 filter(stadtkreis %in% c("Stadt","Veltheim","Seen", "Töss", "Mattenbach", "Oberwinterthur", "Wülflingen"))

```

```{r}
Bevölkerung_Winterthur_Stadtkreise <- winterthur_daten_bereinigt |> 
  group_by(jahr, stadtkreis, staatenkleingruppe) |> 
  summarise(summe = sum(anzahl, na.rm = TRUE))
   
```

```{r}
 write_csv(x = winterthur_daten_bereinigt,
          here::here("daten/processed/Daten-Projekt-hugobre.cvs"))
```

```{r}
winterthur_fct <- winterthur |> 
  mutate(anzahl = factor(anzahl))

winterthur_fct$anzahl <- gsub("[^0-9.]", "", winterthur_fct$anzahl)

winterthur_fct$anzahl <- as.numeric(winterthur_fct$anzahl)

Summe_Jahr_ohne_CH<- winterthur_fct |> 
  group_by(jahr, staatenkleingruppe) |> 
  summarise(summe = sum(anzahl, na.rm = TRUE)) |> 
  filter(staatenkleingruppe != "Schweiz")

Groesste_Gruppen_Winterthur <- Summe_Jahr_ohne_CH |> 
  filter(staatenkleingruppe %in% c("Deutschland", "Italien", "Asien", "Mazedonien", "Türkei", "Afrika"))

```

```{r}
Summe_Jahr_ohne_CH |> 
  arrange(staatenkleingruppe, jahr) |> 
  group_by(staatenkleingruppe) |> 
  mutate(differenz = summe - lag(summe)) |> 
  ungroup()
```

```{r}
winterthur_daten_bereinigt$staat_gruppe <- ifelse(winterthur_daten_bereinigt$staatenkleingruppe == "Schweiz", "Schweiz", "Ausland")

winterthur_daten_bereinigt$anzahl <- 
  as.numeric(winterthur_daten_bereinigt$anzahl)

Winterthur_total <- winterthur_daten_bereinigt |> 
  group_by(jahr, staat_gruppe) |> 
  summarise(sum = sum(anzahl, na.rm = TRUE)) |> 
  mutate(anzahl_in_prozent = sum / sum(sum) * 100)
```

# Daten Visualisierung

```{r}
ggplot(data = Winterthur_total, 
       mapping = aes(x= jahr,
                     y= anzahl_in_prozent,
                     fill = staat_gruppe))+
  geom_col()+
  scale_fill_manual(values = c("aquamarine3", "aquamarine4")) +
  geom_text(aes(label = paste0(round(anzahl_in_prozent,0), "%")),
                position = position_stack(vjust = 0.5),
                color = "black") +
  coord_flip()+
    labs(title = "Bevölkerungsentwicklung Winterthur",
         subtitle = "Ausländer, Schweizer",
         y = NULL,
         x = "Jahr",
         fill = "Staatsangehörigkeit",
         caption = "Daten: https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/")+
  theme_minimal()
```

```{r}
ggplot(data = Groesste_Gruppen_Winterthur,
       mapping = aes (x = jahr,
                      y = summe,
                      group = staatenkleingruppe,
                      color = staatenkleingruppe))+
  geom_line()+
  scale_color_colorblind()+
  labs(title = "Bevölkerungsentwicklung Winterthur",
        subtitle = "Entwicklung der 6 grössten Ausländergruppen in den letzten 10 Jahren",
         y = "Anzahl Personen",
         x = "Jahr",
         color = "Ausländergruppen", shape = "Ausländergruppen",
         caption = "Daten: https://www.zh.ch/de/politik-staat/statistik-daten/datenkatalog.html#/") +
    theme_minimal(base_size = 12) +
    theme(panel.grid.major.x = element_blank(),
          axis.text.x = element_text(angle = 90, 
                                     vjust = 0.5))
```

```{r}
```

```{r}
```
